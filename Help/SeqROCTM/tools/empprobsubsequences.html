<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of empprobsubsequences</title>
  <meta name="keywords" content="empprobsubsequences">
  <meta name="description" content="Estimate the probability of occurrences of all the sequences">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">SeqROCTM</a> &gt; <a href="index.html">tools</a> &gt; empprobsubsequences.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SeqROCTM\tools&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>empprobsubsequences
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Estimate the probability of occurrences of all the sequences</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong> [est_P, est_transP, iT, empHH] = empprobsubsequences(contexts, P, A, seq_length) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">EMPPROBSUBSEQUENCES Estimate the probability of occurrences of all the sequences
                    of length lower than the height of the tree that can be
                    generated by the context tree model. The transition
                    probabilities associated to those sequences are also
                    estimated. The empirical estimates are done on the basis of a
                    realization of the context tree model of length
                    seq_length

 Inputs

  contexts      : contexts of the context tree model
  P             : transition probabilities associated to the contexts
  A             : alphabet
  seq_length    : length of the sequence used to estimate the empirical
                  probabilities est_P and est_transP (this should be a
                  large enough number, by default it is equal to 10^6)
 
 Outputs

  est_P         : cell array with estimates of probabilities of
                  occurrence of all possible sequences of length 1,2,...,height. 
  est_transP    : matrix with estimates of transition probabilities
                  associated to sequences of length 'height'
  iT            : cell array of matrices with the index of the past that is formed given a
                  past and a symbol
  empHH         : empirical entropy (entropy rate computed using the
                  estimates obtained form a realization of size 1,...,N)

Author : Noslen Hernandez (noslen.hernandez-gonzalez@inrae.fr), Aline Duarte (alineduarte@usp.br)
Date   : 08/2020</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../SeqROCTM/data_manipulation/generatesampleCTM.html" class="code" title=" [seq, sP] = generatesampleCTM(contexts, P, A, lengthSeq, initStrategy)">generatesampleCTM</a>	Generates a sample of context tree model.</li><li><a href="contextTree_to_FiniteMarkov.html" class="code" title=" [past, M, Mc, iT, past2ctx] = contextTree_to_FiniteMarkov(contexts, P, A)">contextTree_to_FiniteMarkov</a>	Compute the representation of a context tree model as a k-order Markov process.</li><li><a href="past_with_transitions.html" class="code" title=" [pasts, indexes] = past_with_transitions(past, all_past, N)">past_with_transitions</a>	Return from a list of pasts the ones that can be generated from a given past.</li><li><a href="permn.html" class="code" title=" [M, I] = permn(V, N, K)">permn</a>	- permutations with repetition</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="EMC.html" class="code" title=" compl = EMC(contexts, P, A)">EMC</a>	Compute the Effective Measure Complexity of a context tree model.</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [est_P, est_transP, iT, empHH] = empprobsubsequences(contexts, P, A, seq_length)</a>
0002 <span class="comment">%EMPPROBSUBSEQUENCES Estimate the probability of occurrences of all the sequences</span>
0003 <span class="comment">%                    of length lower than the height of the tree that can be</span>
0004 <span class="comment">%                    generated by the context tree model. The transition</span>
0005 <span class="comment">%                    probabilities associated to those sequences are also</span>
0006 <span class="comment">%                    estimated. The empirical estimates are done on the basis of a</span>
0007 <span class="comment">%                    realization of the context tree model of length</span>
0008 <span class="comment">%                    seq_length</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Inputs</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%  contexts      : contexts of the context tree model</span>
0013 <span class="comment">%  P             : transition probabilities associated to the contexts</span>
0014 <span class="comment">%  A             : alphabet</span>
0015 <span class="comment">%  seq_length    : length of the sequence used to estimate the empirical</span>
0016 <span class="comment">%                  probabilities est_P and est_transP (this should be a</span>
0017 <span class="comment">%                  large enough number, by default it is equal to 10^6)</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% Outputs</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%  est_P         : cell array with estimates of probabilities of</span>
0022 <span class="comment">%                  occurrence of all possible sequences of length 1,2,...,height.</span>
0023 <span class="comment">%  est_transP    : matrix with estimates of transition probabilities</span>
0024 <span class="comment">%                  associated to sequences of length 'height'</span>
0025 <span class="comment">%  iT            : cell array of matrices with the index of the past that is formed given a</span>
0026 <span class="comment">%                  past and a symbol</span>
0027 <span class="comment">%  empHH         : empirical entropy (entropy rate computed using the</span>
0028 <span class="comment">%                  estimates obtained form a realization of size 1,...,N)</span>
0029 <span class="comment">%</span>
0030 <span class="comment">%Author : Noslen Hernandez (noslen.hernandez-gonzalez@inrae.fr), Aline Duarte (alineduarte@usp.br)</span>
0031 <span class="comment">%Date   : 08/2020</span>
0032 
0033 <span class="keyword">if</span> ~exist(<span class="string">'seq_length'</span>, <span class="string">'var'</span>)
0034         seq_length = 10^6;  <span class="comment">% sample size</span>
0035 <span class="keyword">end</span>
0036 
0037 <span class="comment">% height of the context tree</span>
0038 height = max(cellfun(@(x) length(x), contexts, <span class="string">'uniformoutput'</span>, 1));
0039 
0040 <span class="comment">% from context tree to Markov process of order 'height'</span>
0041 [past{height}, ~, Mc, iT{height}] = <a href="contextTree_to_FiniteMarkov.html" class="code" title=" [past, M, Mc, iT, past2ctx] = contextTree_to_FiniteMarkov(contexts, P, A)">contextTree_to_FiniteMarkov</a>(contexts, P, A);
0042 
0043 <span class="comment">% Get the auxiliary matrices for subsequences lower than 'height'</span>
0044 <span class="keyword">for</span> k = 2 : height - 1
0045     [past{k}, I] = <a href="permn.html" class="code" title=" [M, I] = permn(V, N, K)">permn</a>(A, k);  <span class="comment">% all possible past of length k</span>
0046     <span class="keyword">for</span> p = 1 : size(I,1)
0047         [~, idx] = <a href="past_with_transitions.html" class="code" title=" [pasts, indexes] = past_with_transitions(past, all_past, N)">past_with_transitions</a>(I(p,:), I, 3);
0048         iT{k}(p, :) = idx;
0049     <span class="keyword">end</span>
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">% simulates a sequence according to the context tree model</span>
0053 seq = <a href="../../SeqROCTM/data_manipulation/generatesampleCTM.html" class="code" title=" [seq, sP] = generatesampleCTM(contexts, P, A, lengthSeq, initStrategy)">generatesampleCTM</a>(contexts, P, A, seq_length);
0054 
0055 <span class="comment">% iterate the sequence to estimate the prob. of subsequences of length &lt; k</span>
0056 <span class="comment">% and the transition prob.</span>
0057 <span class="comment">% initialize the matrices est_P and est_transP</span>
0058 est_P = cell(height, 1);
0059 est_P{1} = zeros(length(A), 1);
0060 <span class="keyword">for</span> k = 2 : height
0061     est_P{k} = zeros(size(past{k},1), 1);
0062 <span class="keyword">end</span>
0063 est_transP = zeros(size(Mc));
0064 
0065 <span class="comment">% Find the index of the first occurrence of subsequence of length &lt;= k (update</span>
0066 <span class="comment">% frequency of occurrence)</span>
0067 idx_lastpast = zeros(height,1);
0068 idx_symbol = seq(1) + 1;
0069 est_P{1}(idx_symbol) = est_P{1}(idx_symbol) + 1;
0070 <span class="keyword">for</span> p = 2 : height
0071     idx_symbol = seq(p) + 1;
0072     est_P{1}(idx_symbol) = est_P{1}(idx_symbol) + 1;  <span class="comment">% always update frequency of symbols</span>
0073     <span class="keyword">for</span> j = 2 : p-1
0074         idx_currpast = iT{j}(idx_lastpast(j), idx_symbol);
0075         est_P{j}(idx_currpast) = est_P{j}(idx_currpast) + 1;
0076         idx_lastpast(j) = idx_currpast;
0077     <span class="keyword">end</span>
0078     
0079     <span class="comment">% find the index of the first occurrence</span>
0080     found = false;
0081     i = 1;
0082     fpast = seq(1 : p);
0083     <span class="keyword">while</span> ~found 
0084         <span class="keyword">if</span> (sum(fpast ~= past{p}(i,:)) == 0) 
0085             found = true;
0086             idx_lastpast(p) = i;
0087         <span class="keyword">end</span>    
0088     i = i + 1;
0089     <span class="keyword">end</span>
0090     est_P{p}(idx_lastpast(p)) = est_P{p}(idx_lastpast(p)) + 1;
0091 <span class="keyword">end</span>
0092 
0093 <span class="comment">% iterate</span>
0094 empHH = zeros(seq_length, 1);
0095 <span class="keyword">for</span> i = height + 1 : seq_length
0096     idx_symbol = seq(i) + 1;
0097     
0098     <span class="comment">% compute frequency of sequences (pasts) of length k and its transitions</span>
0099     idx_currpast = iT{height}(idx_lastpast(height), idx_symbol);
0100     est_P{height}(idx_currpast) = est_P{height}(idx_currpast) + 1;
0101     est_transP(idx_lastpast(height), idx_symbol) = est_transP(idx_lastpast(height), idx_symbol) + 1;
0102     idx_lastpast(height) = idx_currpast;
0103     
0104     <span class="comment">% compute frequency of sequences of length &lt;= k</span>
0105     <span class="comment">% sequences of length 1</span>
0106     est_P{1}(idx_symbol) = est_P{1}(idx_symbol) + 1;
0107     <span class="comment">% sequences of length 2 : k - 1</span>
0108     <span class="keyword">for</span> j = 2 : height - 1
0109         idx_currpast = iT{j}(idx_lastpast(j), idx_symbol);
0110         est_P{j}(idx_currpast) = est_P{j}(idx_currpast) + 1;
0111         idx_lastpast(j) = idx_currpast;
0112     <span class="keyword">end</span>
0113     
0114     <span class="comment">% update empirical_entropy</span>
0115     <span class="comment">% normalize the probabilities</span>
0116     ss = sum(est_transP, 2);
0117     ss(ss == 0) = 1;
0118     empP = bsxfun(@rdivide, est_transP, ss);
0119     empMu = est_P{height}/(i - k + 1);
0120     empH = 0;
0121     <span class="keyword">for</span> s = 1 : size(past{height},1)
0122         T = 0;
0123         <span class="keyword">for</span> a = 1 : length(A)
0124             <span class="keyword">if</span> empP(s,a) ~= 0, T = T + empP(s,a)*log2(empP(s,a)); <span class="keyword">end</span>
0125         <span class="keyword">end</span>
0126         empH = empH + empMu(s)*(-T);
0127     <span class="keyword">end</span>
0128     empHH(i) = empH;
0129 <span class="keyword">end</span>
0130 
0131 <span class="comment">% normalize probabilities</span>
0132 <span class="keyword">for</span> k = 1 : height
0133     no_past_in_seq = seq_length - k + 1;
0134     est_P{k} = est_P{k}/no_past_in_seq;
0135 <span class="keyword">end</span>
0136 est_transP = bsxfun(@rdivide, est_transP, sum(est_transP,2));
0137 
0138 <span class="keyword">end</span>
0139 
0140</pre></div>
<hr><address>Generated on Wed 10-Jul-2024 11:18:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>